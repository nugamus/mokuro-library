# Installation & Deployment

This guide covers all installation methods for Mokuro Library, from Docker deployment to Windows portable executables.

## üê≥ Docker Installation (Recommended)

The recommended way to run Mokuro Library is with Docker Compose, which handles the database, backend, and frontend in one managed container.

### Prerequisites

- [Git](https://git-scm.com/downloads)
- [Docker Desktop](https://www.docker.com/products/docker-desktop/) (includes `docker compose`)

### Production Deployment

1. **Clone the repository:**
   ```bash
   git clone https://github.com/nguyenston/mokuro-library.git
   cd mokuro-library
   ```

2. **Build the Docker image:**
   ```bash
   docker compose build --no-cache
   ```

3. **Start the container:**
   ```bash
   docker compose up -d
   ```

   The `-d` flag runs the container in detached mode. On first run, the entrypoint script will automatically create and migrate your database.

4. **Access your library:**

   Open `http://localhost:3001` in your browser.

### Data Storage

Based on the `docker-compose.yml` configuration, persistent data folders will be created in your project directory:

- `./data` - Stores your `library.db` database file
- `./data/uploads` - Stores all uploaded manga and series files

### Updating the Application

When you pull new changes or want to update:

1. **Re-build the image:**
   ```bash
   docker compose build
   ```

2. **Re-create the container:**
   ```bash
   docker compose up -d --force-recreate
   ```

   The `--force-recreate` flag applies the new image. The entrypoint script will automatically run database migrations. Your data in `./data` will be preserved.

### Stopping the Container

```bash
# Stop the container
docker compose down

# Stop and remove volumes (‚ö†Ô∏è deletes all data)
docker compose down -v
```

---

## üíª Windows Portable Installation

For users who want to run the library locally without Docker:

### Installation Steps

1. **Download** the latest `MokuroLibrary-Windows.zip` from the [Releases Page](https://github.com/nguyenston/mokuro-library/releases)

2. **Extract** the ZIP file to a folder of your choice

3. **Run** `mokuro-library.exe`
   - A command window will open (don't close it‚Äîthis is the server)
   - Your library will be accessible at `http://localhost:3001`

### Updating Windows Portable

When updating to a new version:

1. Download the latest `MokuroLibrary-Windows.zip`
2. Extract to a new folder
3. **Copy** the `data` and `uploads` folders from your old installation to the new one
4. Run the new `mokuro-library.exe`

::: warning Database Compatibility
The database (`library.db`) generated by the Windows Portable version uses a simplified migration system (`_app_migrations`) for portability. It is **not directly compatible** with the Docker/NAS version.

If you switch from Windows to Docker, you cannot simply copy the database file. You will need to **export and re-import** your library content or manually resolve migrations with `prisma migrate resolve`.
:::

---

## üõ†Ô∏è Development Installation

For contributors and developers who want to work on the codebase.

### Prerequisites

- **Node.js** (v18 or higher) - [Download](https://nodejs.org/)
- **pnpm** (recommended) or npm
- **Git**

### Setup

1. **Clone the repository:**
   ```bash
   git clone https://github.com/nguyenston/mokuro-library.git
   cd mokuro-library
   ```

2. **Install dependencies:**

   Using pnpm (recommended):
   ```bash
   pnpm install
   ```

   Using npm:
   ```bash
   npm install
   ```

### Running in Development Mode

#### Full-Stack Containerized (Recommended)

1. **Build development images:**
   ```bash
   docker compose -f docker-compose.dev.yml build
   ```

2. **Start development environment:**
   ```bash
   docker compose -f docker-compose.dev.yml up
   ```

3. **Access the app:**
   - Frontend: `http://localhost:5173`
   - API: `http://localhost:3000`
   - Hot-reload is enabled for both frontend and backend

#### Local Development (Hybrid)

Run the backend and frontend separately on your host machine:

```bash
# Terminal 1: Backend
cd backend
pnpm dev

# Terminal 2: Frontend
cd frontend
pnpm dev
```

For more details, see the [development documentation](https://github.com/nguyenston/mokuro-library/blob/master/docs/architecture/development.md).

---

## üåê Advanced Deployment

### Using PM2 (Linux/Mac)

For production deployments on Linux servers:

```bash
# Install PM2 globally
npm install -g pm2

# Build the application
pnpm build

# Start with PM2
pm2 start npm --name "mokuro-library" -- start

# Save process list
pm2 save

# Setup auto-start on boot
pm2 startup
```

### Using systemd (Linux)

Create a service file at `/etc/systemd/system/mokuro-library.service`:

```ini
[Unit]
Description=Mokuro Library Server
After=network.target

[Service]
Type=simple
User=your-username
WorkingDirectory=/path/to/mokuro-library
ExecStart=/usr/bin/pnpm start
Restart=on-failure
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
```

Enable and start:

```bash
sudo systemctl enable mokuro-library
sudo systemctl start mokuro-library
sudo systemctl status mokuro-library
```

### Reverse Proxy Setup

For production deployments, use a reverse proxy for HTTPS and improved security.

#### Nginx Configuration

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Increase timeout for large uploads
        proxy_read_timeout 300;
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
    }

    # Increase max body size for uploads
    client_max_body_size 500M;
}
```

#### Caddy Configuration

```caddy
your-domain.com {
    reverse_proxy localhost:3001

    # Increase limits for uploads
    request_body {
        max_size 500MB
    }
}
```

---

## üîß Troubleshooting

### Docker Issues

#### "Docker Desktop - WSL 2 Installation is Incomplete"

This is common on Windows. Docker Desktop uses WSL 2 by default.

**Solution:** Install WSL by running this in an **Administrator PowerShell**:
```powershell
wsl --install
```

Follow the [official Microsoft WSL installation guide](https://learn.microsoft.com/en-us/windows/wsl/install) for detailed instructions.

#### "Virtualization must be enabled" (SVM / VT-x)

Docker requires hardware virtualization to be enabled in your BIOS/UEFI.

**Symptoms:**
- Docker Desktop installation hangs indefinitely
- `wsl --install` hangs and never completes
- Installation appears to freeze with no error message

**Solution:**
1. Restart your computer and enter BIOS/UEFI setup (usually F2, F12, or Del during boot)
2. Look for **Intel Virtualization Technology (VT-x)** or **AMD Secure Virtual Machine (SVM)**
3. Enable it, save changes, and restart
4. Verify in Task Manager ‚Üí Performance ‚Üí CPU that "Virtualization" shows "Enabled"
5. The installations should now complete successfully

#### "Ports are not available" or "Bind for 0.0.0.0:3001 failed"

Another application is using port 3001.

**Solution:**
1. Open `docker-compose.yml`
2. Find the `ports:` section
3. Change the *first* number in `"3001:3001"` to something else:
   ```yaml
   ports:
     - "8080:3001"  # Now accessible at localhost:8080
   ```
4. Restart the container

### Database Issues

#### Database Locked Error

**Causes:**
- Another instance is running
- File permissions issue
- Database file corruption

**Solutions:**
```bash
# Stop all containers
docker compose down

# Check for running processes
docker ps

# Restart with clean state
docker compose up -d
```

#### Reset Database Completely

To wipe your library and start fresh:

1. Stop the container:
   ```bash
   docker compose down
   ```

2. Delete the data folder:
   ```bash
   rm -rf ./data  # Linux/Mac
   rmdir /s ./data  # Windows
   ```

3. Restart the container:
   ```bash
   docker compose up -d
   ```

A fresh database will be created automatically.

### Upload Issues

#### Upload Fails or Timeouts

**Solutions:**
1. Check available disk space
2. Increase upload size limits in reverse proxy (if using one)
3. Check browser console for specific errors
4. Verify the Mokuro files are properly formatted

#### Permission Denied on Uploads

**Linux/Mac:**
```bash
# Fix ownership
sudo chown -R $USER:$USER /path/to/mokuro-library

# Fix permissions
chmod -R 755 /path/to/mokuro-library
```

**Docker:**
```bash
# Run as current user
docker compose down
docker compose up -d --user $(id -u):$(id -g)
```

### Port Conflicts

#### Find and Kill Process Using Port

**Linux/Mac:**
```bash
lsof -ti:3001 | xargs kill -9
```

**Windows:**
```powershell
netstat -ano | findstr :3001
taskkill /PID <PID> /F
```

---

## üìã System Requirements

### Minimum Requirements

| Component | Minimum | Recommended |
|-----------|---------|-------------|
| **CPU** | 2 cores | 4+ cores |
| **RAM** | 2 GB | 4+ GB |
| **Storage** | 10 GB | 50+ GB (depends on library size) |
| **OS** | Windows 10, macOS 10.15, Linux | Linux (for production servers) |

### Network Requirements

- **Ports:** 3001 (default, configurable)
- **Bandwidth:** Depends on library access patterns
- **Internet:** Optional (for metadata scraping)

---

## üîê First-Time Setup

After installation:

1. **Access the application** at `http://localhost:3001`
2. **Create your first account** - First user has admin privileges
3. **Upload manga** - Click the upload button and select Mokuro-processed folders
4. **Start reading!**

For detailed usage instructions, see:
- [Authentication](/authentication)
- [Managing Your Library](/managing-your-library)
- [Using the Reader](/using-the-reader)

---

## üÜò Getting Help

If you encounter issues:

- Check this troubleshooting guide first
- Search [GitHub Issues](https://github.com/nguyenston/mokuro-library/issues)
- Create a new issue with your error logs and system details
- Include your Docker/OS version and steps to reproduce

---

## üì¶ Next Steps

- [Set up authentication](/authentication) for multi-user access
- [Upload your manga library](/managing-your-library)
- [Customize appearance](/appearance-settings)
- [Configure reader settings](/reader-settings)